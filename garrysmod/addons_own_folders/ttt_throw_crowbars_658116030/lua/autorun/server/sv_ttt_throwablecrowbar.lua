CreateConVar("ttt_crowbar_throw_force","600",FCVAR_NOTIFY)CreateConVar("ttt_throwable_magnetostick","1",FCVAR_NOTIFY)hook.Add("InitPostEntity","TTT_ThrowableCrowbar",function()local a=weapons.Get("weapon_zm_improvised")if a then if not a.SecondaryAttack2 then a.SecondaryAttack2=a.SecondaryAttack end;function a:SecondaryAttack()if self.Owner:KeyDown(IN_USE)then TTT_Throw_Crowbar(self)else self:SecondaryAttack2()end end;weapons.Register(a,"weapon_zm_improvised")end;local a=weapons.Get("weapon_zm_carry")if a then a.Primary.Damage=weapons.Get("weapon_zm_improvised").Primary.Damage;if not a.SecondaryAttack2 then a.SecondaryAttack2=a.SecondaryAttack end;function a:SecondaryAttack()if self.Owner:KeyDown(IN_USE)and GetConVar("ttt_throwable_magnetostick"):GetBool()then TTT_Throw_Crowbar(self)else self:SecondaryAttack2()end end;weapons.Register(a,"weapon_zm_carry")end end)function TTT_Throw_Crowbar(a)a.Weapon:SetNextPrimaryFire(CurTime()+a.Primary.Delay)a.Weapon:SetNextSecondaryFire(CurTime()+1)if a.Owner.LagCompensation then a.Owner:LagCompensation(true)end;local b=ents.Create("base_anim")b:SetModel(a.WorldModel)b:SetPos(a.Owner:GetShootPos()-Vector(0,0,10)+a.Owner:GetRight()*6)b:SetAngles(Angle(90,a.Owner:EyeAngles().yaw+45,0))b:Spawn()b:PhysicsInit(SOLID_BBOX)b:GetPhysicsObject():SetMaterial("crowbar")b:GetPhysicsObject():SetMass(1)b:SetOwner(a.Owner)b:SetPhysicsAttacker(a.Owner)b.dmg=a.Primary.Damage;b.origdmg=b.dmg;timer.Simple(0.1,function()if IsValid(b)then b:SetOwner(nil)end end)b:GetPhysicsObject():AddAngleVelocity(Vector(0,1500,0))b:GetPhysicsObject():SetVelocity(a.Owner:GetForward()*(GetConVar("ttt_crowbar_throw_force"):GetInt()+2*a.Owner:GetVelocity():Length())+Vector(0,0,100))b:GetPhysicsObject():Wake()b.ttt_wep_class=a:GetClass()b.owner=a.Owner;b.origpos=b:GetPos()a.Owner:SetAnimation(PLAYER_ATTACK1)function b:Think()self.dmg=self.dmg+0.1 end;a.Owner:EmitSound("Weapon_Crowbar.Single")a.Owner:ViewPunch(Angle(20,0,0))b.fingerprints={a.Owner}function b:PhysicsCollide(c)if c.DeltaTime>0.2 then if IsValid(c.HitEntity)and not c.HitEntity:IsWorld()and IsValid(c.HitEntity:GetPhysicsObject())then if c.HitEntity:GetPhysicsObject():GetMaterial()=="flesh"then c.HitEntity:EmitSound("physics/flesh/flesh_impact_bullet"..math.random(1,5)..".wav",100)end end;self:EmitSound("weapons/crowbar/crowbar_impact"..math.random(1,2)..".wav",70)if c.DeltaTime>0.6 then if IsValid(c.HitEntity)and not c.HitEntity:IsWorld()then local d=DamageInfo()d:SetDamage(math.min(self.dmg,c.OurOldVelocity:Length()*0.5))d:SetDamageType(DMG_CLUB)d:SetAttacker(b.owner)d:SetInflictor(b)d:SetDamageForce(c.OurOldVelocity*0.1)c.HitEntity:TakeDamageInfo(d)if IsValid(c.HitEntity)and c.HitEntity:IsPlayer()then local e=c.HitNormal*GetConVar("ttt_crowbar_pushforce"):GetFloat()e.z=math.Clamp(e.z,50,100)c.HitEntity:SetVelocity(c.HitEntity:GetVelocity()+e)end end end;self.dmg=self.origdmg end end;a.Owner:SelectWeapon("weapon_ttt_unarmed")a.Owner:StripWeapon(a:GetClass())local f="ttt_throw_crowbar"..b:EntIndex()timer.Create(f,0.1,0,function()if not IsValid(b)then timer.Destroy(f)return end;if b:GetVelocity():Length()<=5 then local g=ents.Create(b.ttt_wep_class)g:SetPos(b:GetPos())g:SetAngles(b:GetAngles())g:Spawn()g.fingerprints=b.fingerprints;g.isDropped=true;b:Remove()timer.Destroy(f)end end)end